{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Layout from '../components/Layout';\nimport fetch from 'isomorphic-unfetch';\nimport Alert from 'react-bootstrap/Alert';\nimport PollChoices from '../components/PollChoices';\nimport PollResults from '../components/PollResults';\nimport { withRouter } from 'next/router';\nimport NotFound from './not-found';\nimport absoluteUrl from 'next-absolute-url';\n\nclass PollPage extends React.Component {\n  static async getInitialProps({\n    query: {\n      slug\n    },\n    req\n  }) {\n    const {\n      origin\n    } = absoluteUrl(req);\n    const res = await fetch(`${origin}/api/poll/${slug}`, {\n      method: 'GET',\n      headers: {\n        'X-Origin': 'statmix'\n      }\n    });\n    const errorCode = res.status > 200 ? res.status : false;\n    const data = await res.json();\n    return {\n      errorCode,\n      poll: data.pollData,\n      user: data.userData\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      totalVotes: this.props.poll.totalVotes,\n      results: this.props.poll.results,\n      userDidVote: this.props.user.didVote,\n      revealResults: !this.props.poll.active,\n      resultsLoading: false,\n      refreshResultsLoading: false,\n      selectedVote: null\n    };\n    this.updateChoiceSelected = this.updateChoiceSelected.bind(this);\n    this.loadResults = this.loadResults.bind(this);\n    this.submitVote = this.submitVote.bind(this);\n  }\n\n  updateChoiceSelected(e) {\n    this.setState({\n      selectedVote: e.target.value\n    });\n  }\n\n  async loadResults(e, req) {\n    const {\n      origin\n    } = absoluteUrl(req);\n    const {\n      slug\n    } = this.props.router.query;\n\n    if (!this.state.revealResults) {\n      this.setState({\n        revealResults: true,\n        resultsLoading: true\n      });\n    } else {\n      this.setState({\n        refreshResultsLoading: true\n      });\n    }\n\n    try {\n      const res = await fetch(`${origin}/api/poll/results/${slug}`, {\n        method: 'GET',\n        headers: {\n          'X-Origin': 'statmix'\n        }\n      });\n      const data = await res.json();\n      this.setState({\n        totalVotes: data.totalVotes,\n        userDidVote: data.userDidVote,\n        results: data.results,\n        resultsLoading: false,\n        refreshResultsLoading: false\n      });\n    } catch (err) {}\n  }\n\n  async submitVote(e, req) {\n    e.preventDefault();\n\n    if (this.state.selectedVote !== null) {\n      const {\n        origin\n      } = absoluteUrl(req);\n      const {\n        slug\n      } = this.props.router.query;\n\n      try {\n        const res = await fetch(`${origin}/api/poll/vote/${slug}`, {\n          method: 'POST',\n          headers: {\n            'Accept': 'accplication/json',\n            'Content-Type': 'application/json',\n            'X-Origin': 'statmix'\n          },\n          body: _JSON$stringify({\n            selectedVote: this.state.selectedVote\n          })\n        });\n        const data = await res.json();\n        console.log(data);\n\n        if (data.message === 'error') {\n          console.log('already voted');\n        } else {\n          this.setState({\n            totalVotes: data.resultsData.totalVotes,\n            userDidVote: data.resultsData.userDidVote,\n            selectedVote: data.resultsData.selectedVote\n          });\n          this.loadResults(e, req);\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    } else {// user didnt select vote\n    }\n  }\n\n  render() {\n    // if not data found for poll\n    if (this.props.errorCode) {\n      return __jsx(NotFound, null);\n    }\n\n    const {\n      title,\n      desc,\n      visibility,\n      active,\n      choices,\n      dateCreated,\n      visits,\n      timelimit\n    } = this.props.poll;\n    const {\n      totalVotes,\n      results,\n      userDidVote,\n      revealResults,\n      resultsLoading,\n      refreshResultsLoading\n    } = this.state;\n    return __jsx(Layout, {\n      pageTitle: `Poll - ${title}`,\n      pageDesc: desc\n    }, __jsx(\"div\", {\n      className: \"poll-wrapper\"\n    }, visibility === 'private' ? __jsx(\"div\", {\n      className: \"poll-alert\"\n    }, __jsx(Alert, {\n      variant: \"danger\"\n    }, \"This is a \", __jsx(\"b\", null, \"private\"), \" poll. Please consider before sharing the link.\")) : null, __jsx(\"h4\", {\n      className: \"poll-title\"\n    }, title.length > 0 ? title : 'Untitled'), __jsx(\"hr\", null), __jsx(\"div\", {\n      className: \"poll-desc\"\n    }, __jsx(\"h6\", null, \"Description\"), __jsx(\"div\", null, __jsx(\"p\", null, desc.length > 0 ? desc : __jsx(\"i\", null, \"No description\")), __jsx(\"hr\", null), __jsx(\"div\", {\n      className: \"poll-stat\"\n    }, visits, \" views \\u2022 \", dateCreated))), __jsx(\"hr\", null), active && !userDidVote ? __jsx(PollChoices, {\n      updateChoiceSelected: this.updateChoiceSelected,\n      timelimit: timelimit,\n      choices: choices,\n      revealResults: revealResults,\n      submitVote: this.submitVote,\n      loadResults: this.loadResults\n    }) : null, !active || userDidVote || revealResults ? __jsx(PollResults, {\n      totalVotes: totalVotes,\n      results: results,\n      choices: choices,\n      timelimit: timelimit,\n      resultsLoading: resultsLoading,\n      refreshResultsLoading: refreshResultsLoading,\n      loadResults: this.loadResults\n    }) : null));\n  }\n\n}\n\nPollPage.defaultProps = {\n  poll: {\n    totalVotes: 0,\n    results: []\n  },\n  user: {\n    userDidVote: false\n  },\n  revealResults: false\n};\nexport default withRouter(PollPage);","map":{"version":3,"sources":["E:/Users/Jordan/Desktop/statmix/pages/poll.js"],"names":["Layout","fetch","Alert","PollChoices","PollResults","withRouter","NotFound","absoluteUrl","PollPage","React","Component","getInitialProps","query","slug","req","origin","res","method","headers","errorCode","status","data","json","poll","pollData","user","userData","constructor","props","state","totalVotes","results","userDidVote","didVote","revealResults","active","resultsLoading","refreshResultsLoading","selectedVote","updateChoiceSelected","bind","loadResults","submitVote","e","setState","target","value","router","err","preventDefault","body","console","log","message","resultsData","render","title","desc","visibility","choices","dateCreated","visits","timelimit","length","defaultProps"],"mappings":"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","sourcesContent":["import Layout from '../components/Layout';\nimport fetch from 'isomorphic-unfetch';\nimport Alert from 'react-bootstrap/Alert';\nimport PollChoices from '../components/PollChoices';\nimport PollResults from '../components/PollResults';\nimport { withRouter } from 'next/router'\nimport NotFound from './not-found';\nimport absoluteUrl from 'next-absolute-url';\n\nclass PollPage extends React.Component {\n  static async getInitialProps({ query: { slug }, req }) {\n    const { origin } = absoluteUrl(req);\n    const res = await fetch(`${origin}/api/poll/${slug}`, {\n      method: 'GET',\n      headers: {\n        'X-Origin': 'statmix',\n      }\n    });\n    const errorCode = res.status > 200 ? res.status : false\n    const data = await res.json()\n  \n    return { errorCode, poll: data.pollData, user: data.userData }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      totalVotes: this.props.poll.totalVotes,\n      results: this.props.poll.results,\n      userDidVote: this.props.user.didVote,\n      revealResults: !this.props.poll.active,\n      resultsLoading: false,\n      refreshResultsLoading: false,\n      selectedVote: null,\n    }\n\n    this.updateChoiceSelected = this.updateChoiceSelected.bind(this);\n    this.loadResults = this.loadResults.bind(this);\n    this.submitVote = this.submitVote.bind(this);\n  }\n\n  updateChoiceSelected(e) {\n    this.setState({ selectedVote: e.target.value });\n  }\n\n  async loadResults(e, req) {\n    const { origin } = absoluteUrl(req);\n    const { slug } = this.props.router.query;\n    if(!this.state.revealResults) {\n      this.setState({ revealResults: true, resultsLoading: true });\n    } else {\n      this.setState({ refreshResultsLoading: true });\n    }\n    try {\n      const res = await fetch(`${origin}/api/poll/results/${slug}`, {\n        method: 'GET',\n        headers: {\n          'X-Origin': 'statmix',\n        }\n      });\n      const data = await res.json();\n\n      this.setState({\n        totalVotes: data.totalVotes,\n        userDidVote: data.userDidVote,\n        results: data.results,\n        resultsLoading: false,\n        refreshResultsLoading: false,\n      });\n    } catch (err) {\n      \n    }\n  }\n\n  async submitVote(e, req) {\n    e.preventDefault();\n    if(this.state.selectedVote !== null) {\n      const { origin } = absoluteUrl(req);\n      const { slug } = this.props.router.query;\n      try {\n        const res = await fetch(`${origin}/api/poll/vote/${slug}`, {\n          method: 'POST',\n          headers: {\n            'Accept': 'accplication/json',\n            'Content-Type': 'application/json',\n            'X-Origin': 'statmix',\n          },\n          body: JSON.stringify({selectedVote: this.state.selectedVote})\n        });\n  \n        const data = await res.json();\n        console.log(data);\n        \n        if(data.message === 'error') {\n          console.log('already voted');\n        } else {\n          this.setState({\n            totalVotes: data.resultsData.totalVotes,\n            userDidVote: data.resultsData.userDidVote,\n            selectedVote: data.resultsData.selectedVote\n          });\n          this.loadResults(e, req);\n        }\n        \n      } catch (err) {\n        console.log(err);\n      }\n    } else {\n      // user didnt select vote\n    }\n  }\n\n  render() {\n    // if not data found for poll\n    if (this.props.errorCode) {\n      return <NotFound />\n    }\n\n    const {\n      title,\n      desc,\n      visibility,\n      active,\n      choices,\n      dateCreated,\n      visits,\n      timelimit\n    } = this.props.poll;\n\n    const {\n      totalVotes,\n      results,\n      userDidVote,\n      revealResults,\n      resultsLoading,\n      refreshResultsLoading\n    } = this.state;\n\n    return (\n      <Layout pageTitle={`Poll - ${title}`} pageDesc={desc}>\n        <div className='poll-wrapper'>\n          {visibility === 'private' ?\n            <div className='poll-alert'>\n              <Alert variant='danger'>\n                This is a <b>private</b> poll. Please consider before sharing the link.\n              </Alert>\n            </div>\n          : null }\n          <h4 className='poll-title'>{title.length > 0 ? title : 'Untitled'}</h4>\n          <hr />\n          <div className='poll-desc'>\n            <h6>Description</h6>\n            <div>\n              <p>\n                {desc.length > 0 ? desc : <i>No description</i>}\n              </p>\n              <hr />\n              <div className='poll-stat'>\n                {visits} views • {dateCreated}\n              </div>\n            </div>\n          </div>\n          <hr />\n\n          { active && !userDidVote ?\n          <PollChoices\n            updateChoiceSelected={this.updateChoiceSelected}\n            timelimit={timelimit}\n            choices={choices}\n            revealResults={revealResults}\n            submitVote={this.submitVote}\n            loadResults={this.loadResults}\n          /> : null }\n\n          { !active || userDidVote || revealResults ?\n            <PollResults\n              totalVotes={totalVotes}\n              results={results}\n              choices={choices}\n              timelimit={timelimit}\n              resultsLoading={resultsLoading}\n              refreshResultsLoading={refreshResultsLoading}\n              loadResults={this.loadResults}\n            />\n            : null }\n        </div>\n      </Layout>\n    )\n  }\n}\n\nPollPage.defaultProps = {\n  poll: {\n    totalVotes: 0,\n    results: [],\n  },\n  user: {\n    userDidVote: false  \n  },\n  revealResults: false,\n}\n\nexport default withRouter(PollPage)"]},"metadata":{},"sourceType":"module"}